<!DOCTYPE html>
<html>
  <head>

    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="lib/smoothvoxels.1.1.0.min.js"></script>

    <script src="https://unpkg.com/vue@3"></script>
    <link rel="stylesheet" href="fonts/stylesheet.css" type="text/css" charset="utf-8" />

    <style>
      body {
        margin: 0;
        font-family: '3d_thirteen_pixel_fontsRg', Arial, sans-serif;
        font-size:  40px;
      }
      h1 {
        font-size:  70px;
        font-weight: normal;
      }
      aside {
        margin:  8px;
        width:  30vw;
        height: 100vh;
        display:  inline-block;
        position:  fixed;
      }
      label {
        display:  block;
      }
      main {
        margin-left: 30vw;
        width:  70vw;
        height: 100vh;
        padding: 0;
      }
    </style>

  </head>
  <body id="app">
    <aside>
      <h1>3D Mob</h1>
      <label for="types">Types</label>
      <select id="types" v-model="types" @change="typesChanged($event)">
        <option v-for="option in types_opts">
          {{ option }}
        </option>
      </select>
    </aside>

    <main>
    <a-scene id="scene" background="color: #7CE3B6" vr-mode-ui="false" embedded>
      <a-entity id="camera" camera look-controls="false"></a-entity>


    </a-scene>

    </main>
  </body>

    <script>
      const baseMonkie = `
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- -----AAA----- ----AAAAA---- ----AAAAA---- ----AAAAA---- ----AAAAA---- ----AAAAA---- -----AAA----- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ----AAAAA---- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ----AAAAA---- -----AAA----- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ----AAAAA---- ---AAAAAAA--- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- ---AAAAAAA--- ----AAAAA---- -----AAA----- ------------- ------------- -------------
------------- ------------- ------------- ------------- ----AAAAA---- ---AAAAAAA--- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- ---AAAAAAA--- ----AAAAA---- ------------- ------------- -------------
-----AAA----- -----AAA----- -----AAA----- ----AAAAA---- ---AAAAAAA--- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- -BAAAAAAAAAB- -BAAAAAAAAAB- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAKA-- ---AAAAAAA--- ----AAAAA---- ------------- ------------- -------------
----AAAAA---- ----AAAAA---- ----AAAAA---- ---AAAAAAA--- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- ---AAAAAAA--- ----AAAAA---- ------------- ------------- -------------
----AAAAA---- ----AAAAA---- ----AAAAA---- ---AAAAAAA--- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- ---AAAAAAA--- ----AAAAA---- ------------- ------------- -------------
----AAAAA---- ----AAAAA---- ----AAAAA---- ---AAAAAAA--- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- ---AAAAAAA--- ----AAAAA---- ------------- ------------- -------------
-----AAA----- -----AAA----- -----AAA----- ---AAAAAAA--- ---AAAAAAA--- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- --AAAAAAAAA-- ---AAAAAAA--- -----AAA----- ------------- ------------- -------------
------------- ------------- ------------- ----AAAAA---- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ---AAAAAAA--- ----AAAAA---- ------A------ ------------- ------------- -------------
------------- ------------- ------------- -----BBB----- ----BBBBB---- ---BBBBBBB--- ---BBBBBBB--- ---ABBBBBA--- ---BBBBBBB--- ---BBBBBBB--- ---BBBBBBB--- ---AAAAAAA--- ---AAAAAAA--- ----AAAAA---- -----AAA----- ------------- ------------- ------------- -------------
------------- ------------- ------------- -----BBB----- ----BBBBB---- ----BBBBB---- ----BBBBB---- ----BBBBB---- ----BKBKB---- ----BKBKB---- ----BBBBB---- ----BBABB---- ----AAAAA---- -----AAA----- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- ------------- -------------
`

      var PALETTE = {
        face: {
          normal: '#EAAE75',
          zombie: '#30B17B',
          skelly: '#B6CAD7',
        },
        fur: {
          dark: '#3B3A3A',
          lbrown: '#825039',
          brown: '#442623',
          red: '#A7392C',
          zombie: '#227A56',
          skelly: '#92A4AD',
          albino: '#FFF1D8',
        },
        clothes: {
          blue: '#0A5EF2',
          red: '#C83C3C',
        },
        shades: {
          retro: '#12D1A0',
        },
      }

      var faceColor = PALETTE.face.normal;
      var furColor = PALETTE.fur.brown;
      var BLACK = '#050505';

      var model = {
        faceColor: PALETTE.face.normal,
        furColor: PALETTE.fur.brown,
        voxels: baseMonkie,
      }

      function render(parent, elTag, elAttributes, elText) {

          let element = document.createElement(elTag);

          if (elText !== null && elText !== undefined && elText !== '') {
            element.innerHTML += elText;
          }

          for (let attrName in elAttributes) {
              element.setAttribute(attrName, elAttributes[attrName]);
          };

          if (parent !== undefined)
            return parent.appendChild(element);
          else
            return element;
      }

      var refreshModel = function(modelData) {
        SVOX.models.MobMonkie = `
          size = 13 19 22
          scale = 0.1
          rotation = 0 0 0
          ao = 1 1
          material lighting = flat
            colors = A:${modelData.furColor} B:${modelData.faceColor} K:${BLACK}
          voxels =
${modelData.voxels}
        `;

        let model = document.getElementById('model');
        if (model)
          model.parentNode.removeChild(model);

        let container = document.getElementById('scene');
        model = render(container, 'a-entity', {
          id: "model",
          svox: { model: "MobMonkie" },
          position: "0 0 -2",
          animation: "property:rotation; from:0 0 0; to:0 360 0; loop: true; easing:linear; dur:5000",
        });

      }

      var normalFace = {
        offset: [4, 6, 13],
        dimension: [5, 2, 1],
        voxels: `
BBBBB BBBBB`,

      }

      var types = {
        Brown: {
          furColor: PALETTE.fur.brown,
        },
        "Light Brown": {
          furColor: PALETTE.fur.lbrown,
        },
        Dark: {
          furColor: PALETTE.fur.dark,
        },
        Red: {
          furColor: PALETTE.fur.red,
        },
        Zombie: {
          furColor: PALETTE.fur.zombie,
          faceColor: PALETTE.face.zombie,
        },
        Skeleton: {
          furColor: PALETTE.fur.skelly,
          faceColor: PALETTE.face.skelly,
          mask: {
            offset: [4, 6, 11],
            dimension: [5, 2, 3],
            // offset: [4, 6, 13],
            // dimension: [5, 2, 1],
            voxels: `
 - -  - - -
 - -  - - -
 - -  - - -`,
          }
        },
        Albino: {
          furColor: PALETTE.fur.albino,
        },
      }

      function parseVoxels(mask) {
        var rows = mask.voxels.split('\n');
        rows.shift(); // drop first empty line
        if (rows.length !== mask.dimension[2]) {
          throw "error, expected " + mask.dimension[2] + " rows, got " + rows.length
        }
        rows = rows.map(function(row) {
          if (mask.dimension[0] * mask.dimension[1] + (mask.dimension[1] - 1) !== row.length) {
            throw "error, expected " + mask.dimension[0] + " x " + mask.dimension[1] + " chars, got " + row.length
          }
          var lines = []
          for (var i = 0; i < row.length; i += mask.dimension[0] + 1) {
            lines.push(row.substr(i, mask.dimension[0]))
          }
          return lines
        });
        console.log(rows)
      }

      function mergeVoxels(base, mask) {
        var v = parseVoxels(mask)
        for (var z = 0; z < mask.dimension[2]; z++) {

        }
        return base;
      }

      Vue.createApp({
        data() {
          return {
            message: 'Hello Vue!',
            types: 'Brown',
            types_opts: Object.keys(types),
          }
        },
        methods: {
          typesChanged(event) {
            console.log(event.target.value)
            var t = types[event.target.value]
            model.faceColor = t.faceColor || PALETTE.face.normal
            model.furColor = t.furColor
            model.voxels = mergeVoxels(model.voxels, t.mask || normalFace);
            refreshModel(model)
          }
        }
      }).mount('#app')


      refreshModel(model);


    </script>

</html>
